---

description: "機能実装のためのタスクリストテンプレート"
---

# タスク: [FEATURE NAME]

**入力**: `/specs/[###-feature-name]/` 配下の設計ドキュメント  
**前提条件**: plan.md（必須）、spec.md（ユーザーストーリー参照）、research.md、data-model.md、contracts/

**テスト方針**: 原則2に従い、各ユーザーストーリーで失敗するテストを先行実装する。`modules/<crate>/tests.rs` に配置し、`std` 依存は `cfg(test)` 内に限定する。実装前に対象領域の既存コードを調査し、支配的な設計パターンを把握したうえで着手する。`modules/*-core` で `tokio` や `embassy` を直接利用せず、共有参照・ロックは `modules/utils-core` の `Shared`/`ArcShared` と `Async/SyncMutexLike` 抽象を介して実装する。作業の節目ごとに `./scripts/ci-check.sh all` と `makers ci-check -- dylint` を実行する。  
**構成**: タスクはユーザーストーリー単位でグルーピングし、並列実行可能なものは `[P]` フラグを付ける。

## 形式: `[ID] [P?] [Story] 説明`

- **[P]**: 依存のない並列実行可タスク  
- **[Story]**: 対応するユーザーストーリー（例: US1, US2）  
- 説明には正確なファイルパスを記載すること

## パス規約

- 中心クレート: `modules/actor-core`, `modules/utils-core`  
- 単体テスト: `modules/<crate>/tests.rs` へ配置  
- ベンチマークやホスト指向コードは別クレートまたは `tests/` 配下に隔離

---

## フェーズ1: セットアップ（共通基盤）

**目的**: ワークスペース・依存関係・CI を準備し、`#![no_std]` を確認する。

- [ ] T001 ワークスペース構成を更新し、必要なクレートを追加  
- [ ] T002 `modules/*-core` の `#![no_std]` ビルドとランタイム依存（`tokio`/`embassy`）排除を確認する  
- [ ] T003 [P] `scripts/` や `lints/` の設定を更新（必要な場合）  
- [ ] T004 `./scripts/ci-check.sh all` と `makers ci-check -- dylint` を実行し、失敗時は原因を記録

---

## フェーズ2: 基盤整備（全ストーリーに必須）

**目的**: どのストーリーにも共通するインフラを完成させる。

- [ ] T100 必須のデータ型／メッセージを定義（1 ファイル 1 型/1 trait）  
- [ ] T101 [P] 非同期実行器・スケジューラ等の基盤を整備（必要な場合は `*-std` / `*-embedded` クレートでラップする）  
- [ ] T102 エラーハンドリング・ロギング（`tracing`）を設定  
- [ ] T103 protoactor-go / Apache Pekko との差分を `docs/` または spec に記録  
- [ ] T104 `Shared`/`ArcShared` および `Async/SyncMutexLike` 抽象で共有リソースを実装する設計を確認し、`alloc::sync::Arc` やプラットフォーム固有 Mutex への直接依存がないことをレビュー  
- [ ] T105 関連モジュール（既存の型/アクター/サービス）を調査し、採用されている設計パターン・抽象化・命名規約を整理して plan/spec/tasks に記録する。乖離が必要なら理由と影響範囲を明記する。

---

## フェーズ3: ユーザーストーリー 1（優先度: P1） 🎯 MVP

**目標**: [P1 ストーリーで提供する価値を記述]  
**独立テスト**: [具体的な検証方法を記述]

### テスト（必須）

- [ ] T201 [P] [US1] 単体テストを `modules/<crate>/tests.rs` に追加（失敗する状態で開始）  
- [ ] T202 [P] [US1] 必要なら統合テストを追加（`cfg(test)` 内で `std` を利用可）

### 実装

- [ ] T203 [US1] モデル/構造体を定義（1 ファイル 1 型）  
- [ ] T204 [US1] サービス／アクター挙動を実装  
- [ ] T205 [US1] メッセージ経路の検証とロギングを追加

**チェックポイント**: ストーリー1のテストが緑になっていることを確認。

---

## フェーズ4: ユーザーストーリー 2（優先度: P2）

**目標**: [ストーリー2の価値]  
**独立テスト**: [検証方法]

### テスト（必須）

- [ ] T301 [P] [US2] 単体テスト追加  
- [ ] T302 [P] [US2] 必要な統合テスト

### 実装

- [ ] T303 [US2] 追加エンティティ定義  
- [ ] T304 [US2] 依存タスクとの連携を実装  
- [ ] T305 [US2] テストと仕様の差分を整理

---

## フェーズ5: ユーザーストーリー 3（優先度: P3）

**目標**: [ストーリー3の価値]  
**独立テスト**: [検証方法]

### テスト（必須）

- [ ] T401 [P] [US3] 単体テスト追加  
- [ ] T402 [P] [US3] 統合テスト

### 実装

- [ ] T403 [US3] 新規メッセージ/アクターを実装  
- [ ] T404 [US3] 既存ストーリーとの整合性確認  
- [ ] T405 [US3] ロギングとメトリクス強化

---

## フェーズN: 仕上げ・横断対応

**目的**: ストーリー横断のクリーンアップとドキュメント整備。

- [ ] T501 [P] ドキュメント更新（`docs/`, 憲章差分の追記）  
- [ ] T502 コード整形と不要な `cfg` の削除  
- [ ] T503 パフォーマンス検証・調整  
- [ ] T504 [P] 追加の単体テスト・ベンチマーク  
- [ ] T505 セキュリティ／レースコンディションの確認  
- [ ] T506 `./scripts/ci-check.sh all` と `makers ci-check -- dylint` を最終実行し、結果を添付

---

## 依存関係と実行順序

- **セットアップ（フェーズ1）**: 最優先で実施。ここで `no_std` 制約と CI フローを確定。  
- **基盤整備（フェーズ2）**: フェーズ1完了後に着手。全ストーリーの前提。  
- **ユーザーストーリー（フェーズ3以降）**: フェーズ2完了後に優先度順で実装。並列実行する場合でもテストは各ストーリーで独立させる。  
- **仕上げ（フェーズN）**: 全ストーリー完了後に横断的な改善と最終CIを実施。

### 並列化の指針

- `[P]` が付いたタスクは別ファイル・別モジュールでの作業を想定し、競合を避ける。  
- 共有リソースに触れるタスクは順序を明記する。  
- 破壊的変更を伴う場合は先に spec/tasks に移行手順を記載する。

### 運用ノート

- 各タスク完了時に `./scripts/ci-check.sh all` と `makers ci-check -- dylint` の該当部分を確認する。  
- Serena MCP ツールによるコード参照結果を記録し、既存実装の設計パターンとともに再利用できる形に残す。  
- テストをスキップ／コメントアウトすることは禁止。失敗する場合は理由を記録して修正する。
