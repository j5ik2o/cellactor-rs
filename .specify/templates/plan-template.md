# 実装計画: [FEATURE]

**ブランチ**: `[###-feature-name]` | **作成日**: [DATE] | **参照スペック**: [link]  
**入力資料**: `/specs/[###-feature-name]/spec.md` に定義された機能仕様

**備考**: 本テンプレートは `/speckit.plan` コマンドで生成されます。ワークフローは `AGENTS.md` と憲章を参照してください。

## 概要

[スペックから主要要件と技術方針を抜粋]

## 技術コンテキスト

**言語/バージョン**: Rust nightly（`rust-toolchain.toml` で固定）  
**主要依存関係**: `portable-atomic`, `alloc`, `heapless`（`modules/*-core`）。`tokio` 依存は `modules/*-std`、`embassy-*` 依存は `modules/*-embedded` に限定する。  
**ストレージ**: 組込みデバイス上の揮発メモリ（必要に応じて外部記憶を明示）  
**テスト**: `cargo test`, `criterion`。`std` 依存は `cfg(test)` 内に限定すること。  
**対象プラットフォーム**: RP2040 / RP235x 系マイコンおよびホスト検証環境  
**プロジェクト種別**: マルチクレート（`modules/*-core`）  
**性能目標**: 低レイテンシかつ割込み安全なアクターランタイム。具体値はスペックで定義。  
**制約**: コアクレートは `#![no_std]`。ランタイムに `#[cfg(feature = "std")]` を追加しない。`modules/*-core` で `tokio` や `embassy` を直接依存させない。  
**スケール/スコープ**: 組込み向けアクターシステム。ユーザーストーリー単位で段階提供。

## 憲章チェック

*Phase 0 の前に全てのゲートを満たす計画を示し、Phase 1 終了時点で再確認すること。*

- **ゲートP1（原則1）**: 対象機能が依存する `modules/*-core` クレートが `#![no_std]` でビルド可能である設計か検証する。`std` 依存が必要な場合は別クレートやテスト専用モジュールに切り出す計画を明記する。共有参照やロックは `modules/utils-core` の `Shared` 系・`Async/SyncMutexLike` 抽象のみを使用する計画を示し、直接 `alloc::sync::Arc` 等へ依存しないことを確認する。また `Shared` の命名規約（`_shared` / `Shared` サフィックス、`Handle`/`Driver`/`Facade` 禁止）と公開 API への `Typed` 禁止を守る設計であるかチェックし、循環参照が設計段階で排除されていること、さらに主要コンポーネントがプラガブルに差し替え可能でありつつトレイトオブジェクトの多用に頼らない静的バインディング方針を持つこと、トランスポート/シリアライズ層が抽象化され `no_std` 非対応技術に固定されていないことを確認する。  
- **ゲートP2（原則2）**: ユーザーストーリー毎に失敗するテストを先に記述し、`./scripts/ci-check.sh all` と `makers ci-check -- dylint` の双方を実行する計画を含める。テストの無効化・削除は不可。  
- **ゲートP3（原則3）**: protoactor-go / Apache Pekko の該当箇所を調査し、差分理由と Rust イディオム変換方針を記録する。  
- **ゲートP4（原則4）**: 新規ファイル追加時は 1 ファイル 1 型または 1 trait、`mod.rs` 非使用、`<module>/tests.rs` 配置を計画に落とし込む。  
- **ゲートP5（原則5）**: 破壊的変更がある場合は影響範囲と移行手順を spec/taks に明示し、整合する proposal を先に承認する。  
- **ゲートP6（原則6）**: 実装前に関連モジュールを調査し、既存の設計パターン（例: トレイトオブジェクト/ジェネリック、命名、抽象化）が一致するか確認する。乖離が必要な場合は理由・影響範囲・参照ファイルを記録し、plan/spec/tasks に明示する。  

## プロジェクト構成

### 対象機能のドキュメント

```text
specs/[###-feature-name]/
├── plan.md          # /speckit.plan 出力
├── research.md      # フェーズ0成果
├── data-model.md    # フェーズ1成果
├── quickstart.md    # フェーズ1成果
├── contracts/       # フェーズ1成果
└── tasks.md         # /speckit.tasks 出力
```

### リポジトリ構造（共通基盤）

```text
modules/
├── actor-core/
│   ├── src/
│   └── tests/
├── utils-core/
│   ├── src/
│   └── tests/
lints/
scripts/
└── docs/
```

**構成決定**: 各 `*-core` クレートで機能を完結させ、ホスト固有機能は別クレートやテストに隔離する。

## 複雑度トラッキング

> 憲章チェック違反を一時的に許容する場合のみ記入すること。

| 違反項目 | 必要な理由 | 却下した単純案 |
|----------|------------|----------------|
|          |            |                |
