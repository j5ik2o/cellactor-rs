# tests-location-lint

## 概要
- `separate_tests` リンターは、プロダクションコードとテストコードを物理的に分離し、`<module>/tests.rs` に集約する運用を強制します。
- `protoactor-go` / `pekko` と同様に、テストを別ファイルへ分離することで依存の循環や `cfg(test)` 漏れを防ぎます。

## チェック内容
- `mod tests { ... }` として定義されたインラインテストモジュールを検出します。
- `#[cfg(test)]` が付いた任意のアイテム（関数・impl・const など）が本体ファイルに存在する場合に警告します。
- `#[test]` や `test` 属性を直接付与した関数を見つけた際にも報告し、専用テストファイルへ移動させます。
- `tests.rs` や `tests/ui` 配下、`tests/` ディレクトリ内のファイルは対象外です。

## 違反例
```rust
#[cfg(test)]
mod tests {
  use super::*;

  #[test]
  fn inline_is_rejected() {}
}
```

## 修正ガイド
1. 対象モジュールと同じディレクトリに `tests.rs` を作成し、インラインの `mod tests` 内容を丸ごと移動する。
2. 親ファイルには `#[cfg(test)] mod tests;` だけを残し、テストから本体へアクセスする際は `use super::*;` を利用する。
3. 個別のテスト関数や `#[cfg(test)]` でガードされたヘルパーもすべて `tests.rs` へ移し、必要に応じてユーティリティモジュールを追加する。
4. 移行後に `cargo test` を実行して、新しい構成でテストが通ることを確認する。

## 例外指定
- 一時的に黙認する場合は `#![allow(separate_tests)]` をクレートやファイルに付与できるが、長期的にはテストを分離する。
- ピンポイントに許可する場合は対象アイテムの直前に `#[allow(separate_tests)]` を置く。恒久運用は非推奨。
